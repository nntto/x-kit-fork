# デプロイメントガイド

このガイドでは、Neon PostgreSQL をバックエンドとして使用するウェブサイトの最適なホスティングプラットフォームについて説明します。

## 目次

1. [はじめに](#はじめに)
2. [プラットフォーム比較](#プラットフォーム比較)
3. [推奨プラットフォーム](#推奨プラットフォーム)
4. [デプロイ手順](#デプロイ手順)

## はじめに

Neon は、ストレージとコンピュートリソースを分離したサーバーレス PostgreSQL プラットフォームです。この設計により、以下の特徴を提供します：

- オートスケーリング
- データベースブランチング
- 効率的なリソース利用

## プラットフォーム比較

### Vercel

**無料プラン（Hobby）の制限**:

- 100 GB-時間/月のコンピュート
- 最大 60 秒の関数実行時間
- 100,000 回/月の関数呼び出し
- 100 GB/月の帯域幅
- 6,000 分/月のビルド時間

**Neon 統合**:

- Vercel Marketplace を通じたネイティブ統合
- プレビューデプロイメント用の自動データベースブランチ作成
- Next.js 向けの最適化されたテンプレート

### Cloudflare Pages

**無料プランの特徴**:

- 静的アセットリクエストの無制限帯域幅
- Workers: 1 日 100,000 リクエスト
- 20 分のタイムアウト制限
- アカウントあたり 500 ビルド/月
- ファイルサイズ制限 25 MiB

**Neon 統合**:

- Cloudflare Workers と Hyperdrive を通じた接続
- 効率的なデータベース接続管理
- Worker レベルでの直接統合

### Netlify

**無料プランの制限**:

- サイトあたり 125,000 関数/月
- 100 GB/月の帯域幅
- 300 分/月のビルド時間
- 1 メンバーまで

**Neon 統合**:

- サーバーレス関数と Edge Functions 経由での接続
- @neondatabase/serverless ドライバーのサポート
- Drizzle ORM との統合例あり

### その他のプラットフォーム

- **Railway**: 無料トライアル（\$5 クレジット）のみ
- **Render**: 無料ティアは非アクティブ時にスリープ
- **Deno Deploy**: Deno ランタイムに最適化
- **Koyeb**: 50 時間/月の制限付き無料データベース
- **Heroku**: 無料プラン廃止

## 推奨プラットフォーム

1. **静的サイト中心の場合**: Cloudflare Pages

   - 無制限の静的帯域幅
   - グローバル CDN
   - Workers 経由の効率的な Neon 接続

2. **Next.js/React アプリケーション**: Vercel

   - ネイティブ Neon 統合
   - 優れた開発者体験
   - 自動プレビュー環境

3. **一般的なウェブアプリケーション**: Netlify
   - バランスの取れた無料プラン
   - 柔軟なサーバーレス機能
   - 充実したドキュメント

## デプロイ手順

### Cloudflare Pages の場合

1. GitHub リポジトリとの連携
2. ビルド設定の構成
3. 環境変数の設定（`NEON_DATABASE_URL`など）
4. Workers の設定（必要な場合）

### Vercel の場合

#### 1. 事前準備

- GitHub アカウントの準備
- Vercel アカウントの作成
- 必要な環境変数の準備:
  ```
  AUTH_TOKEN=Xの認証トークン
  GET_ID_X_TOKEN=ユーザーID取得用のトークン
  NEON_DATABASE_URL=NeonデータベースのURL
  ```

#### 2. デプロイ手順

1. GitHub リポジトリのインポート

   - Vercel のダッシュボード（https://vercel.com/dashboard）にアクセス
   - "New Project"をクリック
   - GitHub リポジトリ「x-kit-fork」を選択
   - "Import"をクリック

2. プロジェクト設定

   - プロジェクト名: `x-kit-fork`
   - フレームワークプリセット: `Other`
   - ルートディレクトリ: `./`

3. 環境変数の設定

   - "Environment Variables"セクションで以下を設定:
     ```
     AUTH_TOKEN=Xの認証トークン
     GET_ID_X_TOKEN=ユーザーID取得用のトークン
     NEON_DATABASE_URL=NeonデータベースのURL
     ```

4. デプロイの実行
   - "Deploy"ボタンをクリック
   - ビルドログを確認
   - デプロイ完了後、提供された URL でアプリケーションにアクセス

#### 3. デプロイ結果

- デプロイメント URL: https://x-kit-fork.vercel.app
- デプロイステータス: 成功
- 自動デプロイ設定: 有効（main ブランチへのプッシュで自動デプロイ）

#### 4. 追加設定オプション

1. プレビュー環境

   - 新しいブランチをプッシュすると自動的にプレビュー環境が作成
   - プルリクエストごとに一意の URL が生成

2. パフォーマンスモニタリング

   - Speed Insights の有効化
   - リアルタイムパフォーマンス監視
   - ユーザー体験の追跡

3. カスタムドメイン設定（オプション）

   - プロジェクト設定からドメインを追加可能
   - SSL/TLS 証明書の自動発行
   - DNS レコードの設定手順が提供される

4. 環境変数の管理
   - 本番環境とプレビュー環境で異なる値を設定可能
   - シークレット情報の安全な管理
   - 環境変数の暗号化

#### 5. トラブルシューティング

1. デプロイ失敗時の確認事項

   - ビルドログの確認
   - 環境変数の設定確認
   - 依存関係のインストール確認

2. パフォーマンス問題

   - Speed Insights でのメトリクス確認
   - サーバーレス関数の実行時間
   - メモリ使用量の監視

3. データベース接続
   - Neon 接続文字列の確認
   - ネットワーク設定の確認
   - タイムアウト設定の調整

#### 6. 運用管理

1. 定期的なメンテナンス

   - デプロイメントの監視
   - パフォーマンスの確認
   - セキュリティアップデート

2. スケーリング設定

   - 自動スケーリングの設定
   - リソース使用量の監視
   - コスト最適化

3. バックアップと復旧
   - 自動バックアップの設定
   - ロールバック手順の確認
   - 障害復旧計画の策定

### Netlify の場合

1. GitHub リポジトリの接続
2. ビルド設定の構成
3. 環境変数の設定
4. サーバーレス関数の設定（必要な場合）

## 注意事項

- 無料プランの制限を定期的に監視
- データベース接続の最適化
- セキュリティ設定の確認
- スケーリング要件の評価
